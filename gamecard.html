<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<link rel="stylesheet" href="styles.css">
<script src="mild_questions.js"></script>

<div class="container">
  <div class="section-title">æœ¬è½®é¢˜ç›®</div>
  
  <div class="card">
    <div class="question-id" id="questionId"></div>
    <div class="question" id="questionText"></div>
    <div class="scale-label">
      (<strong>1</strong>æ˜¯æœ€<span class="green" id="negativeText"></span>ï¼Œ<strong>10</strong>æ˜¯æœ€<span class="red" id="positiveText"></span>)
    </div>
  </div>

  <div class="section-title">ä½ çš„å·ç </div>
  <div class="number-card">
    <div class="random-number" id="randomNumber">5</div>
  </div>

  <div class="bottom-bar">
    <div class="emoji">ğŸ’©</div>
    <div class="scale-container">
      <div class="scale-number">1</div>
      <div class="scale-bar">
        <img src="topten.svg" class="topten-logo" alt="TOP TEN">
      </div>
      <div class="scale-number">10</div>
    </div>
    <div class="emoji">ğŸ¦„</div>
  </div>

  <div class="flip-button-container">
    <button class="flip-button" onclick="openGameResult()">å¼€å§‹ç¿»ç‰Œ</button>
    <p class="form-hint">æŸ¥çœ‹æ¸¸æˆç»“æœ</p>
  </div>
</div>

<script>
  // å¼•å…¥script.jsä¸­çš„å‡½æ•°
  function getUrlParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
  }
  
  function generateUniqueRandomNumbers(count, min, max) {
    const numbers = new Set();
    while(numbers.size < count) {
      numbers.add(Math.floor(Math.random() * (max - min + 1)) + min);
    }
    return Array.from(numbers);
  }
  
  function openGameResult() {
    // ä»å½“å‰é¡µé¢çš„ URL å‚æ•°ä¸­è·å–ç©å®¶æ•°é‡
    const playerCount = parseInt(getUrlParam('players')) || 4;
    
    // ç”Ÿæˆéšæœºæ•°
    const numbers = generateUniqueRandomNumbers(playerCount, 1, 10);
    
    // å°†æ•°å­—æ•°ç»„è½¬æ¢ä¸ºURLå‚æ•°
    const numbersParam = numbers.join(',');
    
    // æ„å»ºæ–°çš„URLå¹¶è·³è½¬
    const resultUrl = `creatgame.html?players=${playerCount}&numbers=${numbersParam}&section=result`;
    window.location.href = resultUrl;
  }

  window.onload = function() {
    // è·å–URLå‚æ•°
    const urlParams = new URLSearchParams(window.location.search);
    
    // è®¾ç½®é—®é¢˜å’Œæ ‡ç­¾æ–‡æœ¬
    document.getElementById('questionText').textContent = decodeURIComponent(urlParams.get('question') || 'è¯´å‡ºä¸€ä½YouTuberã€‚');
    document.getElementById('negativeText').textContent = decodeURIComponent(urlParams.get('negative') || 'åŒæ¶');
    document.getElementById('positiveText').textContent = decodeURIComponent(urlParams.get('positive') || 'å–œçˆ±');
    document.getElementById('questionId').textContent = urlParams.get('id') || '';
    
    // è®¾ç½®éšæœºæ•°
    const scaleNumber = urlParams.get('scale') || Math.floor(Math.random() * 10) + 1;
    document.getElementById('randomNumber').textContent = scaleNumber;
    
    // æ ¹æ®é¢˜ç›®ç±»å‹è®¾ç½®å¡ç‰‡èƒŒæ™¯é¢œè‰²å’Œç‚¹å‡»æ•ˆæœ
    const questionType = urlParams.get('type');
    const card = document.querySelector('.card');
    const numberCard = document.querySelector('.number-card');
    
    if (questionType === 'spicy') {
      card.classList.add('spicy-card');
      numberCard.classList.add('spicy-card');
      // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œåˆ›å»ºè¾£æ¤’emoji
      card.addEventListener('click', createSpicyEmoji);
      numberCard.addEventListener('click', createSpicyEmoji);
    } else if (questionType === 'extreme') {
      card.classList.add('extreme-card');
      numberCard.classList.add('extreme-card');
      // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œåˆ›å»ºç´«è‰²æ³¡æ³¡
      card.addEventListener('click', createPoisonBubble);
      numberCard.addEventListener('click', createPoisonBubble);
    }
  }
  
  // åˆ›å»ºè¾£æ¤’emojiçš„å‡½æ•°
  function createSpicyEmoji(event) {
    const emoji = document.createElement('div');
    emoji.textContent = 'ğŸŒ¶ï¸';
    emoji.className = 'floating-emoji';
    
    // è®¾ç½®åˆå§‹ä½ç½®ä¸ºç‚¹å‡»ä½ç½®
    emoji.style.left = (event.clientX - 10) + 'px';
    emoji.style.top = (event.clientY - 10) + 'px';
    
    document.body.appendChild(emoji);
    
    // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
    emoji.addEventListener('animationend', () => {
      document.body.removeChild(emoji);
    });
  }
  
  // åˆ›å»ºç´«è‰²æ³¡æ³¡çš„å‡½æ•°
  function createPoisonBubble(event) {
    const bubble = document.createElement('div');
    bubble.className = 'poison-bubble';
    
    // è®¾ç½®åˆå§‹ä½ç½®ä¸ºç‚¹å‡»ä½ç½®
    bubble.style.left = (event.clientX - 10) + 'px';
    bubble.style.top = (event.clientY - 10) + 'px';
    
    document.body.appendChild(bubble);
    
    // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
    bubble.addEventListener('animationend', () => {
      document.body.removeChild(bubble);
    });
  }
</script> 